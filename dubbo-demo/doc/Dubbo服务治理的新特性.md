# 负载均衡

可分为软件负载（nginx）和硬件负载

## 负载均衡算法

（1）RandomLoadBalance
权重随机算法，根据权重值进行随机负载

它的算法思想很简单。假设我们有一组服务器 servers = [A, B, C]，他们对应的权重为
weights = [5, 3, 2]，权重总和为 10。现在把这些权重值平铺在一维坐标值上，[0, 5) 区
间属于服务器 A，[5, 8) 区间属于服务器 B，[8, 10) 区间属于服务器 C。接下来通过
随机数生成器生成一个范围在 [0, 10) 之间的随机数，然后计算这个随机数会落到哪个
区间上。比如数字 3 会落到服务器 A 对应的区间上，此时返回服务器 A 即可。权重
越大的机器，在坐标轴上对应的区间范围就越大，因此随机数生成器生成的数字就会
有更大的概率落到此区间内。只要随机数生成器产生的随机数分布性很好，在经过多
次选择后，每个服务器被选中的次数比例接近其权重比例

（2）LeastActiveLoadBalance
最少活跃调用数算法，活跃调用数越小，表明该服务提供者效率越高，单位时间内可处理更多的请求这个是比较科学的负载均衡算法

每个服务提供者对应一个活跃数 active。初始情况下，所有服务提供者活跃数均为 0。
每收到一个请求，活跃数加 1，完成请求后则将活跃数减 1。在服务运行一段时间后，
性能好的服务提供者处理请求的速度更快，因此活跃数下降的也越快，此时这样的服
务提供者能够优先获取到新的服务请求

（3）ConsistentHashLoadBalance
hash 一致性算法，相同参数的请求总是发到同一提供者
当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，
不会引起剧烈变动

（4）RoundRobinLoadBalance
加权轮询算法，所谓轮询是指将请求轮流分配给每台服务器

个例子，我们有三台服务器 A、B、C。
我们将第一个请求分配给服务器 A，第二个请求分配给服务器 B，第三个请求分配给
服务器 C，第四个请求再次分配给服务器 A。这个过程就叫做轮询。轮询是一种无状
态负载均衡算法，实现简单，适用于每台服务器性能相近的场景下。但现实情况下，
我们并不能保证每台服务器性能均相近。如果我们将等量的请求分配给性能较差的服
务器，这显然是不合理的。因此，这个时候我们需要对轮询过程进行加权，以调控每
台服务器的负载。经过加权后，每台服务器能够得到的请求数比例，接近或等于他们
的权重比。比如服务器 A、B、C 权重比为 5:2:1。那么在 8 次请求中，服务器 A 将
收到其中的 5 次请求，服务器 B 会收到其中的 2 次请求，服务器 C 则收到其中的 1次请求



# 集群容错

# 服务降级

# Dubbo新的功能

